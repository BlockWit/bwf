package com.blockwit.bwf.service.chains.common.service;

import lombok.extern.slf4j.Slf4j;
import org.web3j.abi.TypeReference;
import org.web3j.abi.datatypes.Address;
import org.web3j.abi.datatypes.Bool;
import org.web3j.protocol.Web3j;
import org.web3j.protocol.core.RemoteFunctionCall;
import org.web3j.protocol.core.methods.response.TransactionReceipt;
import org.web3j.tx.Contract;
import org.web3j.tx.TransactionManager;
import org.web3j.tx.gas.ContractGasProvider;

import java.math.BigInteger;
import java.util.Arrays;
import java.util.Collections;

@Slf4j
public class SwapContract extends Contract {

  public static final String CONTRACT_BIN = "608060405234801561001057600080fd5b506040516112123803806112128339818101604052602081101561003357600080fd5b505160006100486001600160e01b036100b716565b600080546001600160a01b0319166001600160a01b0383169081178255604051929350917f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e0908290a350600380546001600160a01b0319166001600160a01b03929092169190911790556100bb565b3390565b611148806100ca6000396000f3fe6080604052600436106100a75760003560e01c8063731b5fef11610064578063731b5fef146101b75780638da5cb5b146101e157806390d49b9d14610212578063f25f4b5614610245578063f2fde38b1461025a578063fc0c546a1461028d576100a7565b8063144fa6d7146100ac57806334e19907146100f3578063492b50d71461011f57806354cf2aeb1461013c5780636c605b7714610163578063715018a6146101a2575b600080fd5b3480156100b857600080fd5b506100df600480360360208110156100cf57600080fd5b50356001600160a01b03166102a2565b604080519115158252519081900360200190f35b3480156100ff57600080fd5b5061011d6004803603602081101561011657600080fd5b5035610749565b005b6100df6004803603602081101561013557600080fd5b50356107a6565b34801561014857600080fd5b50610151610935565b60408051918252519081900360200190f35b34801561016f57600080fd5b506100df6004803603606081101561018657600080fd5b508035906001600160a01b03602082013516906040013561093b565b3480156101ae57600080fd5b5061011d610a7c565b3480156101c357600080fd5b506100df600480360360208110156101da57600080fd5b5035610b1e565b3480156101ed57600080fd5b506101f6610b33565b604080516001600160a01b039092168252519081900360200190f35b34801561021e57600080fd5b5061011d6004803603602081101561023557600080fd5b50356001600160a01b0316610b42565b34801561025157600080fd5b506101f6610bbc565b34801561026657600080fd5b5061011d6004803603602081101561027d57600080fd5b50356001600160a01b0316610bcb565b34801561029957600080fd5b506101f6610cc3565b60006102ac610cd2565b6000546001600160a01b039081169116146102fc576040805162461bcd60e51b815260206004820181905260248201526000805160206110c9833981519152604482015290519081900360640190fd5b6002546001600160a01b038381169116141561034d576040805162461bcd60e51b815260206004820152600b60248201526a185b1c9958591e481cd95d60aa1b604482015290519081900360640190fd5b6060826001600160a01b03166306fdde036040518163ffffffff1660e01b815260040160006040518083038186803b15801561038857600080fd5b505afa15801561039c573d6000803e3d6000fd5b505050506040513d6000823e601f3d908101601f1916820160405260208110156103c557600080fd5b81019080805160405193929190846401000000008211156103e557600080fd5b9083019060208201858111156103fa57600080fd5b825164010000000081118282018810171561041457600080fd5b82525081516020918201929091019080838360005b83811015610441578181015183820152602001610429565b50505050905090810190601f16801561046e5780820380516001836020036101000a031916815260200191505b5060405250505090506060836001600160a01b03166395d89b416040518163ffffffff1660e01b815260040160006040518083038186803b1580156104b257600080fd5b505afa1580156104c6573d6000803e3d6000fd5b505050506040513d6000823e601f3d908101601f1916820160405260208110156104ef57600080fd5b810190808051604051939291908464010000000082111561050f57600080fd5b90830190602082018581111561052457600080fd5b825164010000000081118282018810171561053e57600080fd5b82525081516020918201929091019080838360005b8381101561056b578181015183820152602001610553565b50505050905090810190601f1680156105985780820380516001836020036101000a031916815260200191505b5060405250505090506000846001600160a01b031663313ce5676040518163ffffffff1660e01b815260040160206040518083038186803b1580156105dc57600080fd5b505afa1580156105f0573d6000803e3d6000fd5b505050506040513d602081101561060657600080fd5b5051600280546001600160a01b0319166001600160a01b0388811691909117918290556040805160ff851691810191909152606080825287519082015286519394509116917fdd368d1daac2d49c89f2177a1dfbb1a0c72762b98fc4e1ccacba03114cffe0e2918691869186918190602080830191608084019188019080838360005b838110156106a1578181015183820152602001610689565b50505050905090810190601f1680156106ce5780820380516001836020036101000a031916815260200191505b50838103825285518152855160209182019187019080838360005b838110156107015781810151838201526020016106e9565b50505050905090810190601f16801561072e5780820380516001836020036101000a031916815260200191505b509550505050505060405180910390a2506001949350505050565b610751610cd2565b6000546001600160a01b039081169116146107a1576040805162461bcd60e51b815260206004820181905260248201526000805160206110c9833981519152604482015290519081900360640190fd5b600455565b60006107b133610cd6565b156107ed5760405162461bcd60e51b81526004018080602001828103825260218152602001806110826021913960400191505060405180910390fd5b333214610841576040805162461bcd60e51b815260206004820152601f60248201527f70726f787920636f6e74726163747320617265206e6f7420616c6c6f77656400604482015290519081900360640190fd5b6004543414610888576040805162461bcd60e51b815260206004820152600e60248201526d77726f6e6720737761702066656560901b604482015290519081900360640190fd5b6002546108a6906001600160a01b031633308563ffffffff610cdc16565b34156108e7576003546040516001600160a01b03909116903480156108fc02916000818181858888f193505050501580156108e5573d6000803e3d6000fd5b505b60025460408051848152346020820152815133936001600160a01b0316927ff60309f865a6aa297da5fac6188136a02e5acfdf6e8f6d35257a9f4e9653170f928290030190a3506001919050565b60045481565b6000610945610cd2565b6000546001600160a01b03908116911614610995576040805162461bcd60e51b815260206004820181905260248201526000805160206110c9833981519152604482015290519081900360640190fd5b60008481526001602052604090205460ff16156109f1576040805162461bcd60e51b81526020600482015260156024820152746273632074782066696c6c656420616c726561647960581b604482015290519081900360640190fd5b6000848152600160208190526040909120805460ff19169091179055600254610a2a906001600160a01b0316848463ffffffff610d3c16565b6002546040805184815290516001600160a01b038087169388939116917f6a7b2e85c9adcee9c40970c6fcdb78f57d45931efee389c62b5293af702e52749181900360200190a45060015b9392505050565b610a84610cd2565b6000546001600160a01b03908116911614610ad4576040805162461bcd60e51b815260206004820181905260248201526000805160206110c9833981519152604482015290519081900360640190fd5b600080546040516001600160a01b03909116907f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e0908390a3600080546001600160a01b0319169055565b60016020526000908152604090205460ff1681565b6000546001600160a01b031690565b610b4a610cd2565b6000546001600160a01b03908116911614610b9a576040805162461bcd60e51b815260206004820181905260248201526000805160206110c9833981519152604482015290519081900360640190fd5b600380546001600160a01b0319166001600160a01b0392909216919091179055565b6003546001600160a01b031681565b610bd3610cd2565b6000546001600160a01b03908116911614610c23576040805162461bcd60e51b815260206004820181905260248201526000805160206110c9833981519152604482015290519081900360640190fd5b6001600160a01b038116610c685760405162461bcd60e51b815260040180806020018281038252602681526020018061105c6026913960400191505060405180910390fd5b600080546040516001600160a01b03808516939216917f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e091a3600080546001600160a01b0319166001600160a01b0392909216919091179055565b6002546001600160a01b031681565b3390565b3b151590565b604080516001600160a01b0380861660248301528416604482015260648082018490528251808303909101815260849091019091526020810180516001600160e01b03166323b872dd60e01b179052610d36908590610d93565b50505050565b604080516001600160a01b038416602482015260448082018490528251808303909101815260649091019091526020810180516001600160e01b031663a9059cbb60e01b179052610d8e908490610d93565b505050565b6060610de8826040518060400160405280602081526020017f5361666545524332303a206c6f772d6c6576656c2063616c6c206661696c6564815250856001600160a01b0316610e449092919063ffffffff16565b805190915015610d8e57808060200190516020811015610e0757600080fd5b5051610d8e5760405162461bcd60e51b815260040180806020018281038252602a8152602001806110e9602a913960400191505060405180910390fd5b6060610e538484600085610e5b565b949350505050565b606082471015610e9c5760405162461bcd60e51b81526004018080602001828103825260268152602001806110a36026913960400191505060405180910390fd5b610ea585610cd6565b610ef6576040805162461bcd60e51b815260206004820152601d60248201527f416464726573733a2063616c6c20746f206e6f6e2d636f6e7472616374000000604482015290519081900360640190fd5b60006060866001600160a01b031685876040518082805190602001908083835b60208310610f355780518252601f199092019160209182019101610f16565b6001836020036101000a03801982511681845116808217855250505050505090500191505060006040518083038185875af1925050503d8060008114610f97576040519150601f19603f3d011682016040523d82523d6000602084013e610f9c565b606091505b5091509150610fac828286610fb7565b979650505050505050565b60608315610fc6575081610a75565b825115610fd65782518084602001fd5b8160405162461bcd60e51b81526004018080602001828103825283818151815260200191508051906020019080838360005b83811015611020578181015183820152602001611008565b50505050905090810190601f16801561104d5780820380516001836020036101000a031916815260200191505b509250505060405180910390fdfe4f776e61626c653a206e6577206f776e657220697320746865207a65726f2061646472657373636f6e74726163747320617265206e6f7420616c6c6f77656420746f2073776170416464726573733a20696e73756666696369656e742062616c616e636520666f722063616c6c4f776e61626c653a2063616c6c6572206973206e6f7420746865206f776e65725361666545524332303a204552433230206f7065726174696f6e20646964206e6f742073756363656564a2646970667358221220b0db556f4843252fe8795e4afa35e51e99703d181df619f1abb7fc4b8c87897464736f6c63430006040033000000000000000000000000ca4744261da0561bd9a8b7f8d913a12c2ac72972";

  public static final String CONTRACT_ABI = "[{\"inputs\":[{\"internalType\":\"address payable\",\"name\":\"_feeWallet\",\"type\":\"address\"}],\"stateMutability\":\"nonpayable\",\"type\":\"constructor\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"internalType\":\"address\",\"name\":\"previousOwner\",\"type\":\"address\"},{\"indexed\":true,\"internalType\":\"address\",\"name\":\"newOwner\",\"type\":\"address\"}],\"name\":\"OwnershipTransferred\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"internalType\":\"address\",\"name\":\"tokenAddr\",\"type\":\"address\"},{\"indexed\":true,\"internalType\":\"bytes32\",\"name\":\"otherTxHash\",\"type\":\"bytes32\"},{\"indexed\":true,\"internalType\":\"address\",\"name\":\"toAddress\",\"type\":\"address\"},{\"indexed\":false,\"internalType\":\"uint256\",\"name\":\"amount\",\"type\":\"uint256\"}],\"name\":\"SwapFinalized\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"internalType\":\"address\",\"name\":\"tokenAddr\",\"type\":\"address\"},{\"indexed\":true,\"internalType\":\"address\",\"name\":\"fromAddr\",\"type\":\"address\"},{\"indexed\":false,\"internalType\":\"uint256\",\"name\":\"amount\",\"type\":\"uint256\"},{\"indexed\":false,\"internalType\":\"uint256\",\"name\":\"feeAmount\",\"type\":\"uint256\"}],\"name\":\"SwapStarted\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"internalType\":\"address\",\"name\":\"tokenAddr\",\"type\":\"address\"},{\"indexed\":false,\"internalType\":\"string\",\"name\":\"name\",\"type\":\"string\"},{\"indexed\":false,\"internalType\":\"string\",\"name\":\"symbol\",\"type\":\"string\"},{\"indexed\":false,\"internalType\":\"uint8\",\"name\":\"decimals\",\"type\":\"uint8\"}],\"name\":\"TokenSet\",\"type\":\"event\"},{\"inputs\":[],\"name\":\"feeWallet\",\"outputs\":[{\"internalType\":\"address payable\",\"name\":\"\",\"type\":\"address\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"bytes32\",\"name\":\"otherTxHash\",\"type\":\"bytes32\"},{\"internalType\":\"address\",\"name\":\"toAddress\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"amount\",\"type\":\"uint256\"}],\"name\":\"finalizeSwap\",\"outputs\":[{\"internalType\":\"bool\",\"name\":\"\",\"type\":\"bool\"}],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"bytes32\",\"name\":\"\",\"type\":\"bytes32\"}],\"name\":\"finalizedTxs\",\"outputs\":[{\"internalType\":\"bool\",\"name\":\"\",\"type\":\"bool\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"owner\",\"outputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"renounceOwnership\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address payable\",\"name\":\"newWallet\",\"type\":\"address\"}],\"name\":\"setFeeWallet\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"fee\",\"type\":\"uint256\"}],\"name\":\"setSwapFee\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"newToken\",\"type\":\"address\"}],\"name\":\"setToken\",\"outputs\":[{\"internalType\":\"bool\",\"name\":\"\",\"type\":\"bool\"}],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"amount\",\"type\":\"uint256\"}],\"name\":\"startSwap\",\"outputs\":[{\"internalType\":\"bool\",\"name\":\"\",\"type\":\"bool\"}],\"stateMutability\":\"payable\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"swapFee\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"token\",\"outputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"newOwner\",\"type\":\"address\"}],\"name\":\"transferOwnership\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"}]";

  public static final String FUNC_FINALIZE_SWAP = "finalizeSwap";

  public static final String FUNC_FINALIZED_TXS = "finalizedTxs";

  public static final String FUNC_TOKEN = "token";

  protected SwapContract(Web3j web3j,
                         String contractAddress,
                         TransactionManager transactionManager,
                         ContractGasProvider gasProvider) {
    super(CONTRACT_BIN, contractAddress, web3j, transactionManager, gasProvider);
  }

  public RemoteFunctionCall<Boolean> finalizedTxs(byte[] param0) {
    final org.web3j.abi.datatypes.Function function = new org.web3j.abi.datatypes.Function(
        FUNC_FINALIZED_TXS,
        Arrays.asList(new org.web3j.abi.datatypes.generated.Bytes32(param0)),
        Arrays.asList(new TypeReference<Bool>() {
        }));
    return executeRemoteCallSingleValueReturn(function, Boolean.class);
  }

  public RemoteFunctionCall<TransactionReceipt> finalizeSwap(byte[] otherTxHash, String toAddress, BigInteger amount) {
    final org.web3j.abi.datatypes.Function function = new org.web3j.abi.datatypes.Function(
        FUNC_FINALIZE_SWAP,
        Arrays.asList(new org.web3j.abi.datatypes.generated.Bytes32(otherTxHash),
            new org.web3j.abi.datatypes.Address(160, toAddress),
            new org.web3j.abi.datatypes.generated.Uint256(amount)),
        Collections.emptyList());
    return executeRemoteCallTransaction(function);
  }

  public RemoteFunctionCall<String> token() {
    final org.web3j.abi.datatypes.Function function = new org.web3j.abi.datatypes.Function(FUNC_TOKEN,
        Arrays.asList(),
        Arrays.asList(new TypeReference<Address>() {
        }));
    return executeRemoteCallSingleValueReturn(function, String.class);
  }

}
